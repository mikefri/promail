<!DOCTYPE html>
<html lang="fr" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProMail Express • AI Pro Transformer 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.5); } 50% { box-shadow: 0 0 30px 15px rgba(99, 102, 241, 0); } }
        .fade-in-up { animation: fadeInUp 0.8s ease-out forwards; }
        .glow-hover:hover { box-shadow: 0 0 35px 15px rgba(99, 102, 241, 0.4); transform: translateY(-3px); }
        .glass { backdrop-filter: blur(20px); background: rgba(30, 41, 59, 0.5); border: 1px solid rgba(99, 102, 241, 0.25); }
        body { 
            background: linear-gradient(135deg, #0f172a, #1e1b4b, #312e81, #4f46e5); 
            background-attachment: fixed; 
            overflow-x: hidden;
        }
        .particles { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; 
            background: radial-gradient(circle at 20% 30%, rgba(99,102,241,0.08) 0%, transparent 50%);
            animation: pulseGlow 12s infinite alternate;
        }
    </style>
</head>
<body class="min-h-screen text-gray-100 flex items-center justify-center p-6 relative font-sans">
    <div class="particles"></div>

    <div class="w-full max-w-6xl relative z-10">
        <!-- Grande card container -->
        <div class="glass rounded-3xl p-8 md:p-12 shadow-2xl shadow-indigo-900/50 transition-all duration-500 hover:shadow-indigo-700/60">
            
            <!-- Titre global -->
            <div class="text-center mb-10">
                <h1 class="text-5xl font-extrabold bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400 bg-clip-text text-transparent flex items-center justify-center gap-4">
                    <i class="fas fa-wand-magic-sparkles text-5xl animate-pulse"></i>
                    ProMail Express
                </h1>
                <p class="mt-3 text-indigo-300 opacity-90">AI Multi-Models • Historique • Tutoiement respecté</p>
            </div>

            <!-- Conteneur flex pour les deux cards -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
                
                <!-- Card GAUCHE : Historique -->
                <div class="glass rounded-2xl p-8 order-2 lg:order-1 flex flex-col">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-indigo-300">Historique</h3>
                        <button onclick="clearHistory()" class="text-sm text-red-400 hover:text-red-300 transition flex items-center gap-2">
                            <i class="fas fa-trash-alt"></i> Effacer tout
                        </button>
                    </div>
                    <div id="historyList" class="flex-1 overflow-y-auto space-y-4 pr-2 max-h-[60vh] lg:max-h-[70vh]">
                        <!-- Historique items ici -->
                    </div>
                    <p class="mt-4 text-sm text-center text-indigo-400/70">Clique sur une entrée pour revoir le résultat</p>
                </div>

                <!-- Card DROITE : Formulaire principal -->
                <div class="glass rounded-2xl p-8 order-1 lg:order-2">
                    <!-- Sélecteur modèle -->
                    <div class="mb-8">
                        <label class="block text-sm font-medium text-indigo-300 mb-3">Modèle IA</label>
                        <select id="modelSelect" class="w-full px-6 py-5 bg-gray-900/40 border border-indigo-500/30 rounded-2xl text-white focus:outline-none focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/50 transition-all glass">
                            <option value="Qwen/Qwen2.5-7B-Instruct">Qwen2.5-7B-Instruct (Équilibré, excellent FR)</option>
                            <option value="HuggingFaceTB/SmolLM3-3B">SmolLM3-3B (Ultra-rapide)</option>
                            <option value="meta-llama/Llama-3.2-3B-Instruct">Llama-3.2-3B-Instruct (Fiable & léger)</option>
                            <option value="meta-llama/Meta-Llama-3-8B-Instruct">Llama-3-8B-Instruct (Premium classique)</option>
                        </select>
                    </div>

                    <!-- Toggle forcer tutoiement -->
                    <div class="mb-8 flex items-center justify-between">
                        <label class="text-sm font-medium text-indigo-300">Forcer tutoiement (toujours "tu")</label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="forceTu" class="sr-only peer">
                            <div class="w-14 h-7 bg-gray-700 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-indigo-800 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[4px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-6 after:w-6 after:transition-all peer-checked:bg-indigo-600"></div>
                        </label>
                    </div>

                    <!-- Clé API -->
                    <div class="mb-8">
                        <label class="block text-sm font-medium text-indigo-300 mb-3">Token Hugging Face</label>
                        <div class="relative">
                            <input type="password" id="tk" placeholder="hf_..." class="w-full px-6 py-5 bg-gray-900/40 border border-indigo-500/30 rounded-2xl text-white placeholder-gray-500 focus:outline-none focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/50 transition-all glass" onchange="saveToken()">
                            <i class="fas fa-key absolute right-5 top-1/2 -translate-y-1/2 text-indigo-400"></i>
                        </div>
                    </div>

                    <!-- Message -->
                    <div class="mb-10">
                        <label class="block text-sm font-medium text-indigo-300 mb-3">Ton message</label>
                        <textarea id="msg" rows="6" placeholder="Ex: Yo mec, envoie le rapport demain stp ça urge..." class="w-full px-6 py-5 bg-gray-900/40 border border-indigo-500/30 rounded-2xl text-white placeholder-gray-500 focus:outline-none focus:border-indigo-400 focus:ring-2 focus:ring-indigo-500/50 transition-all resize-none glass"></textarea>
                    </div>

                    <!-- Bouton -->
                    <button onclick="send()" class="w-full py-6 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 hover:from-indigo-700 hover:via-purple-700 hover:to-pink-700 text-white font-bold text-xl rounded-2xl shadow-2xl shadow-purple-900/50 hover:shadow-purple-700/70 transform hover:scale-105 transition-all duration-300 flex items-center justify-center gap-4 glow-hover">
                        <i class="fas fa-magic text-2xl"></i> TRANSFORMER
                    </button>

                    <!-- Loader -->
                    <div id="lod" class="hidden mt-8 text-center text-indigo-400 font-medium flex items-center justify-center gap-3 animate-pulse">
                        <i class="fas fa-brain text-2xl animate-spin"></i> En cours...
                    </div>

                    <!-- Résultat -->
                    <div id="res" class="hidden mt-10 p-8 glass rounded-2xl border-indigo-500/40 fade-in-up relative">
                        <button id="copyBtn" class="absolute top-4 right-4 text-indigo-300 hover:text-white transition-colors text-xl" title="Copier">
                            <i class="fas fa-copy"></i>
                        </button>
                        <div id="resultText" class="text-lg leading-relaxed text-gray-200 whitespace-pre-wrap"></div>
                    </div>
                </div>
            </div>

            <!-- Footer global -->
            <p class="mt-12 text-center text-sm text-indigo-300/70">
                Powered by Hugging Face Inference Providers • Modèles open-source • 2026 vibes
            </p>
        </div>
    </div>

    <script>
        // Sauvegarde token
        function saveToken() {
            const tk = document.getElementById('tk').value.trim();
            if (tk) localStorage.setItem('saved_tk', tk);
        }
        document.getElementById('tk').value = localStorage.getItem('saved_tk') || '';

        // Historique
        let history = JSON.parse(localStorage.getItem('promail_history')) || [];
        function renderHistory() {
            const list = document.getElementById('historyList');
            list.innerHTML = '';
            if (history.length === 0) {
                list.innerHTML = '<p class="text-center text-indigo-400/70 py-10">Aucune transformation pour l\'instant...</p>';
                return;
            }
            history.forEach((item) => {
                const div = document.createElement('div');
                div.className = 'p-5 glass rounded-xl cursor-pointer hover:bg-indigo-900/30 transition group';
                div.innerHTML = `
                    <div class="flex justify-between text-sm text-indigo-400 mb-2">
                        <span>${item.model.split('/').pop()}</span>
                        <span>${new Date(item.date).toLocaleString('fr-FR', {hour: '2-digit', minute:'2-digit'})}</span>
                    </div>
                    <div class="text-gray-300 mb-2 line-clamp-3">${item.original.substring(0,100)}${item.original.length > 100 ? '...' : ''}</div>
                    <div class="text-white font-medium line-clamp-3">${item.result.substring(0,120)}${item.result.length > 120 ? '...' : ''}</div>
                `;
                div.onclick = () => {
                    document.getElementById('resultText').innerText = item.result;
                    document.getElementById('res').classList.remove('hidden');
                    document.getElementById('res').scrollIntoView({ behavior: 'smooth' });
                };
                list.appendChild(div);
            });
        }
        renderHistory();

        function addToHistory(original, result, model) {
            history.unshift({ original, result, model, date: Date.now() });
            if (history.length > 30) history.pop();
            localStorage.setItem('promail_history', JSON.stringify(history));
            renderHistory();
        }

        function clearHistory() {
            if (confirm("Effacer tout l'historique ?")) {
                history = [];
                localStorage.removeItem('promail_history');
                renderHistory();
            }
        }

        // Send function
        async function send() {
            const token = document.getElementById('tk').value.trim();
            const msg = document.getElementById('msg').value.trim();
            const model = document.getElementById('modelSelect').value;
            const forceTu = document.getElementById('forceTu').checked;
            const loader = document.getElementById('lod');
            const res = document.getElementById('res');
            const resultText = document.getElementById('resultText');

            if (!token || !msg) {
                alert("Token + message obligatoires !");
                return;
            }

            loader.classList.remove('hidden');
            res.classList.add('hidden');

            const systemPrompt = forceTu ?
                `Tu es un assistant qui reformule des messages en français professionnel, poli et concis (style email pro).
Toujours utiliser le tutoiement ("tu", "toi", "ton", "ta", etc.), même si le message original est formel ou utilise "vous". Sois naturel, élégant et sympa.` :
                `Tu es un assistant qui reformule des messages en français professionnel, poli et concis (style email pro).
Respecte scrupuleusement le niveau de familiarité de l'original :
- Si l'original utilise "tu" ou un ton amical/informel → garde absolument le tutoiement ("tu", "toi", etc.).
- Si l'original utilise "vous" ou un ton formel → utilise le vouvoiement ("vous", "votre", etc.).
- Si neutre ou ambigu → préfère le tutoiement léger et sympa.
Ne passe JAMAIS au vouvoiement si l'original est en "tu".`;

            try {
                const resp = await fetch("https://router.huggingface.co/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${token}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        model: model,
                        messages: [
                            { role: "system", content: systemPrompt },
                            { role: "user", content: `Reformule ce message de façon très professionnelle, polie et concise (style email professionnel français parfait) :\n\n${msg}` }
                        ],
                        max_tokens: 400,
                        temperature: 0.65
                    })
                });

                if (!resp.ok) throw new Error((await resp.json()).error?.message || "Erreur API");

                const data = await resp.json();
                const text = data.choices[0].message.content.trim();

                resultText.innerText = text;
                res.classList.remove('hidden');

                addToHistory(msg, text, model);

            } catch (e) {
                alert("Erreur : " + e.message + "\nVérifie token/modèle/quota !");
                console.error(e);
            } finally {
                loader.classList.add('hidden');
            }
        }

        document.getElementById('copyBtn').onclick = () => {
            const txt = document.getElementById('resultText').innerText;
            navigator.clipboard.writeText(txt).then(() => alert("Copié !")).catch(() => alert("Erreur copie."));
        };
    </script>
</body>
</html>
