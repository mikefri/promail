<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProMail Expert | Version Router</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: white; width: 90%; max-width: 400px; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); text-align: center; }
        h2 { color: #4f46e5; }
        textarea, input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: #4f46e5; color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        #res { margin-top: 20px; padding: 15px; background: #f8fafc; border-left: 5px solid #4f46e5; display: none; text-align: left; white-space: pre-wrap; }
    </style>
</head>
<body>

<div class="card">
    <h2>ProMail Expert</h2>
    <input type="password" id="tk" placeholder="Colle ta clé hf_..." onchange="localStorage.setItem('pro_token', this.value)">
    <textarea id="msg" rows="5" placeholder="Ton message à transformer..."></textarea>
    <button onclick="send()">AMÉLIORER MON MESSAGE</button>
    <p id="lod" style="display:none">⏳ L'IA génère le message...</p>
    <div id="res"></div>
</div>

<script>
    // Chargement auto de la clé sauvegardée
    document.getElementById('tk').value = localStorage.getItem('pro_token') || '';

    async function send() {
        const t = document.getElementById('tk').value.trim();
        const m = document.getElementById('msg').value.trim();
        const out = document.getElementById('res');
        const lod = document.getElementById('lod');

        if(!t || !m) return alert("Remplis la clé et le message !");
        lod.style.display = "block";
        out.style.display = "none";

        try {
            // L'ADRESSE EXACTE RECOMMANDÉE PAR HUGGING FACE DANS TON ERREUR
            const url = "https://router.huggingface.co/hf-inference/models/mistralai/Mistral-7B-Instruct-v0.3";
            
            const response = await fetch(url, {
                method: "POST",
                headers: { 
                    "Authorization": `Bearer ${t}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ 
                    inputs: `[INST] Réécris ce message de façon professionnelle et polie en français : ${m} [/INST]`,
                    parameters: { max_new_tokens: 300, return_full_text: false }
                })
            });

            const data = await response.json();
            
            if (response.ok) {
                // Gestion du format de réponse (Tableau ou Objet)
                let text = Array.isArray(data) ? data[0].generated_text : data.generated_text;
                out.innerText = text.trim();
                out.style.display = "block";
            } else {
                alert("Erreur : " + (data.error || "Problème avec le serveur IA"));
            }
        } catch (err) {
            alert("Connexion impossible. Tente en navigation privée.");
        } finally {
            lod.style.display = "none";
        }
    }
</script>
</body>
</html>
