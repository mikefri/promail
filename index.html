<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Correcteur Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: #f8fafc;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .btn-primary {
            background: #4f46e5;
            transition: all 0.2s;
        }
        .btn-primary:hover {
            background: #4338ca;
            transform: translateY(-1px);
        }
        .btn-primary:disabled {
            background: #94a3b8;
            transform: none;
            cursor: not-allowed;
        }
        .btn-secondary {
            background: white;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }
        .btn-secondary:hover {
            background: #f8fafc;
            border-color: #cbd5e1;
        }
        .btn-secondary.active {
            background: #4f46e5;
            color: white;
            border-color: #4f46e5;
        }
        textarea:focus, select:focus, input:focus {
            outline: none;
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }
        .result-box {
            background: white;
            border: 2px solid #e2e8f0;
            min-height: 200px;
        }
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 16px 24px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-left: 4px solid #10b981;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        .toast.error {
            border-left-color: #ef4444;
        }
        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="p-6">
    <div class="max-w-5xl mx-auto">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Correcteur Pro</h1>
            <p class="text-gray-500">Corrigez vos messages avec l'IA</p>
        </div>

        <!-- API Key Section (si pas sauvegard√©e) -->
        <div id="apiKeySection" class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 mb-6">
            <h3 class="font-semibold text-gray-900 mb-2">üîë Configuration requise (une seule fois)</h3>
            <p class="text-sm text-gray-600 mb-4">
                Obtenez votre cl√© API gratuite sur 
                <a href="https://platform.openai.com/api-keys" target="_blank" class="text-indigo-600 underline">OpenAI</a>
                (offre 5$ de cr√©dit gratuit)
            </p>
            <div class="flex gap-3">
                <input 
                    type="password" 
                    id="apiKey" 
                    placeholder="sk-..." 
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-lg"
                >
                <button onclick="saveApiKey()" class="btn-primary px-6 py-2 text-white rounded-lg">
                    Enregistrer
                </button>
            </div>
        </div>

        <!-- Configuration rapide -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                
                <!-- Mode correction -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
                    <select id="mode" class="w-full px-4 py-2 border border-gray-300 rounded-lg">
                        <option value="fix">Corriger les erreurs</option>
                        <option value="improve">Am√©liorer le style</option>
                        <option value="formal">Plus formel</option>
                        <option value="simple">Plus simple</option>
                    </select>
                </div>

                <!-- Tu/Vous -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Ton</label>
                    <div class="flex gap-2">
                        <button type="button" onclick="setTone('tu')" id="btnTu" class="btn-secondary flex-1 px-4 py-2 rounded-lg text-sm font-medium">
                            Tu
                        </button>
                        <button type="button" onclick="setTone('vous')" id="btnVous" class="btn-secondary active flex-1 px-4 py-2 rounded-lg text-sm font-medium">
                            Vous
                        </button>
                    </div>
                </div>

                <!-- Contexte -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Pour</label>
                    <div class="flex gap-2">
                        <button type="button" onclick="setContext('email')" id="btnEmail" class="btn-secondary active flex-1 px-4 py-2 rounded-lg text-sm font-medium">
                            Email
                        </button>
                        <button type="button" onclick="setContext('teams')" id="btnTeams" class="btn-secondary flex-1 px-4 py-2 rounded-lg text-sm font-medium">
                            Teams
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Zone de texte -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            
            <!-- Input -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Votre texte</label>
                <textarea 
                    id="input" 
                    rows="12" 
                    placeholder="Collez votre message ici..."
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg resize-none"
                ></textarea>
            </div>

            <!-- Output -->
            <div>
                <div class="flex justify-between items-center mb-2">
                    <label class="block text-sm font-medium text-gray-700">Texte corrig√©</label>
                    <button 
                        id="copyBtn" 
                        onclick="copyResult()" 
                        class="text-sm text-gray-500 hover:text-gray-700 hidden"
                    >
                        üìã Copier
                    </button>
                </div>
                <div id="output" class="result-box w-full px-4 py-3 rounded-lg text-gray-700 whitespace-pre-wrap overflow-y-auto" style="max-height: 400px;">
                    <div class="text-gray-400 text-center pt-20">
                        Le r√©sultat appara√Ætra ici
                    </div>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="flex justify-center gap-4">
            <button 
                id="correctBtn"
                onclick="correct()" 
                class="btn-primary px-8 py-3 text-white rounded-lg font-medium shadow-sm"
            >
                <span id="btnText">Corriger</span>
                <span id="btnLoading" class="hidden">
                    <svg class="inline w-5 h-5 spinner" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    Correction...
                </span>
            </button>
            <button 
                onclick="clearAll()" 
                class="btn-secondary px-8 py-3 rounded-lg font-medium"
            >
                Effacer
            </button>
        </div>

        <!-- Info -->
        <div class="mt-8 text-center text-sm text-gray-500">
            <p>‚ú® Propuls√© par OpenAI GPT-4 ‚Ä¢ Correction instantan√©e</p>
            <p class="mt-1 text-xs">Raccourci : <kbd class="px-2 py-1 bg-gray-100 rounded">Ctrl + Enter</kbd> pour corriger</p>
        </div>
    </div>

    <script>
        let tone = 'vous';
        let context = 'email';
        let isProcessing = false;

        // Check if API key exists
        const savedApiKey = localStorage.getItem('openai_api_key');
        if (savedApiKey) {
            document.getElementById('apiKeySection').style.display = 'none';
        }

        function saveApiKey() {
            const apiKey = document.getElementById('apiKey').value.trim();
            if (!apiKey) {
                showToast('Entrez votre cl√© API', true);
                return;
            }
            if (!apiKey.startsWith('sk-')) {
                showToast('La cl√© API doit commencer par "sk-"', true);
                return;
            }
            localStorage.setItem('openai_api_key', apiKey);
            document.getElementById('apiKeySection').style.display = 'none';
            showToast('‚úì Cl√© API enregistr√©e !');
        }

        function setTone(t) {
            tone = t;
            document.getElementById('btnTu').classList.toggle('active', t === 'tu');
            document.getElementById('btnVous').classList.toggle('active', t === 'vous');
        }

        function setContext(c) {
            context = c;
            document.getElementById('btnEmail').classList.toggle('active', c === 'email');
            document.getElementById('btnTeams').classList.toggle('active', c === 'teams');
        }

        function showToast(msg, isError = false) {
            const toast = document.createElement('div');
            toast.className = 'toast' + (isError ? ' error' : '');
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function copyResult() {
            const text = document.getElementById('output').textContent;
            navigator.clipboard.writeText(text).then(() => {
                showToast('‚úì Copi√© !');
            });
        }

        function clearAll() {
            document.getElementById('input').value = '';
            document.getElementById('output').innerHTML = '<div class="text-gray-400 text-center pt-20">Le r√©sultat appara√Ætra ici</div>';
            document.getElementById('copyBtn').classList.add('hidden');
        }

        function getPrompt() {
            const mode = document.getElementById('mode').value;
            const toneText = tone === 'tu' ? 'Utilise le tutoiement (tu, te, ton).' : 'Utilise le vouvoiement (vous, votre).';
            const contextText = context === 'email' ? 'un email professionnel' : 'un message Teams';

            const prompts = {
                fix: `Tu es un correcteur expert. Corrige uniquement les fautes d'orthographe, de grammaire, de conjugaison et de ponctuation. Ne change pas le style ni le ton. ${toneText}

R√©ponds UNIQUEMENT avec le texte corrig√©, sans explication.`,
                
                improve: `Tu es un assistant de r√©daction professionnelle. Am√©liore ce texte pour ${contextText} : corrige toutes les erreurs, rends-le plus professionnel, fluide et agr√©able √† lire. ${toneText}

R√©ponds UNIQUEMENT avec le texte am√©lior√©, sans explication.`,
                
                formal: `Tu es un expert en communication formelle. Transforme ce texte pour le rendre plus formel et professionnel, adapt√© √† ${contextText}. Corrige toutes les erreurs. ${toneText}

R√©ponds UNIQUEMENT avec le texte formel, sans explication.`,
                
                simple: `Tu es un expert en clart√©. Simplifie ce texte : utilise des phrases courtes et un vocabulaire simple tout en restant professionnel pour ${contextText}. Corrige toutes les erreurs. ${toneText}

R√©ponds UNIQUEMENT avec le texte simplifi√©, sans explication.`
            };

            return prompts[mode];
        }

        async function correct() {
            if (isProcessing) return;
            
            const apiKey = localStorage.getItem('openai_api_key');
            if (!apiKey) {
                showToast('Configurez d\'abord votre cl√© API', true);
                document.getElementById('apiKeySection').style.display = 'block';
                return;
            }

            const input = document.getElementById('input').value.trim();
            if (!input) {
                showToast('Entrez un texte √† corriger', true);
                return;
            }

            isProcessing = true;
            const correctBtn = document.getElementById('correctBtn');
            const btnText = document.getElementById('btnText');
            const btnLoading = document.getElementById('btnLoading');
            const outputDiv = document.getElementById('output');

            // UI Loading state
            correctBtn.disabled = true;
            btnText.classList.add('hidden');
            btnLoading.classList.remove('hidden');
            outputDiv.innerHTML = '<div class="text-gray-400 text-center pt-20"><svg class="inline w-8 h-8 spinner text-indigo-600" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg><p class="mt-2">Correction en cours...</p></div>';

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${apiKey}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-4o-mini',
                        messages: [
                            {
                                role: 'system',
                                content: getPrompt()
                            },
                            {
                                role: 'user',
                                content: input
                            }
                        ],
                        temperature: 0.3,
                        max_tokens: 1000
                    })
                });

                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error?.message || 'Erreur API');
                }

                const data = await response.json();
                const result = data.choices?.[0]?.message?.content?.trim() || 'Erreur lors de la correction';

                outputDiv.textContent = result;
                document.getElementById('copyBtn').classList.remove('hidden');
                showToast('‚úì Correction termin√©e !');

            } catch (error) {
                console.error('Erreur:', error);
                outputDiv.innerHTML = `<div class="text-red-500 text-center pt-20">‚ùå ${error.message}</div>`;
                showToast('Erreur : ' + error.message, true);
            } finally {
                isProcessing = false;
                correctBtn.disabled = false;
                btnText.classList.remove('hidden');
                btnLoading.classList.add('hidden');
            }
        }

        // Ctrl+Enter to submit
        document.getElementById('input').addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                correct();
            }
        });
    </script>
</body>
</html>
