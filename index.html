<script>
async function tester() {
    const t = document.getElementById('token').value.trim();
    const m = document.getElementById('msg').value;
    const resDiv = document.getElementById('result');
    const debug = document.getElementById('debug');

    if(!t || !m) return alert("Complète les champs !");

    document.getElementById('loader').style.display = "block";
    resDiv.style.display = "none";

    try {
        const response = await fetch("https://api-inference.huggingface.co/models/mistralai/Mixtral-8x7B-Instruct-v0.1", {
            headers: { 
                "Authorization": "Bearer " + t,
                "Content-Type": "application/json"
            },
            method: "POST",
            body: JSON.stringify({ inputs: "Reformule en français pro : " + m }),
        });

        const data = await response.json();

        if (response.ok) {
            resDiv.innerText = data[0].generated_text.split("pro :")[1] || data[0].generated_text;
            resDiv.style.display = "block";
        } else {
            debug.innerText = "Erreur : " + data.error;
        }
    } catch (err) {
        debug.innerText = "Blocage navigateur (CORS). Désactive tes bloqueurs de pub ou Brave Shield.";
    } finally {
        document.getElementById('loader').style.display = "none";
    }
}
</script>
